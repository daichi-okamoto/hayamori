<% content_for(:title, 'シフト完成') %>
<body>
  <header class="bg-slate-100 border-b h-16"> <!-- ここでヘッダーの高さを固定 -->
    <div class="flex justify-between container mx-auto py-2">
      <h1>
        <a href="#" class="flex">
          <svg xmlns="http://www.w3.org/2000/svg" height="48px" viewBox="0 -960 960 960" width="48px" fill="#334155">
            <path d="M180-80q-24 0-42-18t-18-42v-620q0-24 18-42t42-18h65v-60h65v60h340v-60h65v60h65q24 0 42 18t18 42v260h-60v-70H180v430h320v60H180Zm0-550h600v-130H180v130Zm0 0v-130 130ZM560-80v-123l221-220q9-9 20-13t22-4q12 0 23 4.5t20 13.5l37 37q9 9 13 20t4 22q0 11-4.5 22.5T902.09-300L683-80H560Zm300-263-37-37 37 37ZM620-140h38l121-122-18-19-19-18-122 121v38Zm141-141-19-18 37 37-18-19Z"/>
          </svg>
          <span class="flex items-center text-slate-700 text-xl  font-bold ml-1">Care Shift</span>
        </a> 
      </h1>
    </div>
  </header>
  
  <div class="flex">
    <!-- サイドバー -->
    <%= render 'layouts/shift_sidebar' %>
    <main class="lg:flex-1 mx-auto sm:w-full lg:w-9/12 xl:w-9/12 h-[calc(100vh-64px)] bg-slate-50">
      <%= form_with url: shifts_path, method: :post, local: true do %>
      <% @employees.each do |e| %>
        <% @calendar.each_with_index do |c, index| %>
          <% shift = @schedule_output[e.name]&.at(index) %>
          <input type="hidden" name="shifts[][date]" value="<%= c %>">
          <input type="hidden" name="shifts[][shift_type]" value="<%= shift %>">
          <input type="hidden" name="shifts[][employee_id]" value="<%= e.id %>">
        <% end %>
      <% end %>
        <div class="flex justify-between p-4 ">
          <div class="flex space-x-1">
            <p class="flex items-center text-gray-600 text-lg font-bold">
              シフトを保存してください
            </p>
          </div>
          <%= render 'layouts/flash_messages' %>
          <div>
            <%= submit_tag 'シフトを保存', class: 'border py-1 px-7 rounded font-bold text-sm text-gray-500 hover:bg-sky-400 hover:border-sky-400 hover:text-white duration-300 transition active:scale-95' %>
          </div>
        </div>
      <% end %>
    <div class="overflow-auto overflow-y-auto sm:w-11/12 md:w-11/12 lg:w-[calc(100%-40px)] xl:w-[calc(100%-34px)] sm:max-h-[900px] md:max-h-[1000px] lg:h-[calc(100vh-150px)] xl:h-[calc(100vh-144px)] 2xl:h-[calc(100vh-144px)] mx-4">
      <table class="table-fixed w-full border-separate border-spacing-0 bg-white">
        <thead>
          <tr>
            <th class="p-1 w-40 sticky left-0 top-0 z-20 bg-white text-gray-600 border">日付</th>
            <!-- 日付 -->
            <% @calendar.each do |c| %>
              <td class="border p-1 w-12 text-center sticky top-0 z-10 bg-white text-gray-600 font-semibold"><%= "#{c.month}/#{c.day}" %></td>
            <% end %>
          </tr>
        </thead>
        <thead>
          <tr>
            <th class="p-1 w-40 sticky left-0 top-8 z-20 bg-white text-gray-600 border">曜日</th>
            <!-- 曜日 -->
            <% @calendar.each do |c| %>
              <% if c.wday == 0 %>
                <td class="border p-1 text-red-400 text-center sticky top-8 bg-white z-10 font-semibold">
                  <%= @weeks[c.wday] %>
                </td>
              <% elsif c.wday == 6 %>
                <td class="border p-1 text-sky-400 text-center sticky top-8 bg-white z-10 font-semibold">
                  <%= @weeks[c.wday] %>
                </td>
              <% else %>
                <td class="border text-gray-600 p-1 text-center sticky top-8 bg-white z-10 font-semibold">
                  <%= @weeks[c.wday] %>
                </td>
              <% end %>
            <% end %>
          </tr>
        </thead>
        <thead>
          <tr>
            <th class="sticky left-0 z-10 bg-white border text-center text-gray-600 py-16">
              委員会 <br> 予定 <br> 行事
            </th>
            <!-- メモ -->
            <% @calendar.each do |c| %>
              <td class="border text-gray-600 text-sm writing-mode-vertical"><%= @memos[c]&.content %></td>
            <% end %>
          </tr>
        </thead>
        <thead>
          <tr>
            <!-- 従業員名 -->
            <% @employees.each do |e| %>
              <% if e.employee_type == '正社員' %>
                <th class="sticky left-0 z-20 border bg-white p-2 text-center text-sky-400"><%= e.name %></th>
              <% elsif e.employee_type == 'パート' %>
                <th class="sticky left-0 z-20 border bg-white p-2 text-center text-green-500"><%= e.name %></th>
              <% else %>
                <th class="sticky left-0 z-20 border bg-white p-2 text-center text-gray-700"><%= e.name %></th>
              <% end %>
              <!-- シフト -->
              <% @calendar.each_with_index do |c, index| %>
              <% actual_shift = @schedule_output[e.name][index]%>
              <% shift_request = @shift_requests.find { |s| s.employee_id == e.id && s.date == c } %>
              <td class="border p-2 text-center text-gray-700">
                <% if @schedule_output[e.name] %>
                  <% shift = @schedule_output[e.name][index] %>
                  <% case shift %>
                  <% when "早番" %>
                  <span class="flex items-center">
                    H
                    <%= content_tag(:span, "キ", class: "text-sm") if shift_request&.shift_type == actual_shift %>
                  </span>
                  <% when "日勤" %>
                    &nbsp; <!-- 空白にする -->
                  <% when "遅番" %>
                  <span class="flex items-center">
                    O
                    <%= content_tag(:span, "キ", class: "text-sm") if shift_request&.shift_type == actual_shift %>
                  </span>
                  <% when "夜勤", "夜勤明け" %>
                  <span class="flex items-center">
                    Y
                    <%= content_tag(:span, "キ", class: "text-sm") if shift_request&.shift_type == actual_shift %>
                  </span>
                  <% when "休み" %>
                    <span class="flex items-center">
                      ⚫️
                      <%= content_tag(:span, "キ", class: "text-sm") if shift_request&.shift_type == actual_shift %>
                    </span>
                  <% else %>
                    <%= shift %>
                  <% end %>
                <% end %>
              </td>
              <% end %>
            </tr>
          </thead>
        <% end %>
      </table>
    </div>
    </main>
  </div>
  </body>